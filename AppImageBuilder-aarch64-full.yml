# appimagebuilder (aarch64) for PrusaSlicer (full)
#
# This yml file uses an AppDir to package an AppImage. The AppDir is
# generated by `build.sh`
#
version: 1

script: |
  cd ./PrusaSlicer/build
  DESTDIR=AppDir cmake --build ./ --target install -j $(nproc)
  mkdir -p AppDir/usr/share/icons
  cp AppDir/usr/resources/icons/PrusaSlicer.svg ./AppDir/usr/share/icons

AppDir:
  path: ./PrusaSlicer/build/AppDir
  app_info:
    id: com.prusa3d.PrusaSlicer
    name: PrusaSlicer
    icon: PrusaSlicer
    version: %%VERSION%%
    exec: usr/bin/prusa-slicer
    exec_args: $@
  apt:
    arch:
      - arm64
    allow_unauthenticated: true
    sources:
      - sourceline: deb http://deb.debian.org/debian bullseye main contrib non-free
      - sourceline:
          deb http://security.debian.org/debian-security bullseye-security
          main contrib non-free
      - sourceline: deb http://deb.debian.org/debian bullseye-updates main contrib non-free
      - sourceline: deb http://archive.raspberrypi.org/debian/ bullseye main
    include:
      - libdbus-1-3:arm64
      - libgpg-error0:arm64
      - liblzma5:arm64
      - libnss-mdns:arm64
      - libpcre3:arm64
      - libselinux1:arm64
      - libtinfo6:arm64
      - libwebkit2gtk-4.0-dev
      - libwebkit2gtk-4.1-dev
    exclude:
      - adwaita-icon-theme
      - distro-info-data
      - fonts-liberation2
      - fonts-piboto
      - gnome-icon-theme
      - gvfs:arm64
      - hicolor-icon-theme
      - locales
      - lsb-release
      - pixflat-icons
      - python3-logilab-common
      - raspberrypi-ui-mods
      - libgnutls30:arm64
  files:
    include:
      - /lib/aarch64-linux-gnu/libstdc++.so.6
      - /lib/aarch64-linux-gnu/libpthread.so.0
      - /lib/aarch64-linux-gnu/libm.so.6
      - /usr/lib/aarch64-linux-gnu/libstdc++.so.6
      - /lib/aarch64-linux-gnu/libc.so.6
    exclude:
      - lib/aarch64-linux-gnu/libmali.so.1
      - usr/share/man
      - usr/share/doc/*/README.*
      - usr/share/doc/*/changelog.*
      - usr/share/doc/*/NEWS.*
      - usr/share/doc/*/TODO.*
      - usr/share/locale

AppImage:
  arch: aarch64
  comp: xz
  update-information: guess
